
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="http://illuminatorslab.sinacloud.net/favicon.ico" />

    <title>顺德杏坛中学建校60周年纪念头像生成器</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!--自定义样式-->
    <link href="css/index.css" rel="stylesheet">

    <!--引入CropperJS-->
    <link  href="cropperjs/cropper.min.css" rel="stylesheet">
    <script src="cropperjs/cropper.min.js"></script>
</head>
<body>
<div class="container-fluid">
  <img src="images/qr_code2.png" id="qr_code" style="position: absolute;top: -1000px;width:50px;"/>
    <div class="row">
        <!--模板列表-->
        <div class="main-content col-xs-12">
            <img id="header-img" src="images/header.jpg" class="img-responsive center-block" alt="headerimg">

            <div class="header-title">
              <img class="title-image" src="images/logo2.jpg"/>
            </div>

            <div class="images-header-content clearfix">
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">1</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">2</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">3</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">4</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">5</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">6</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">7</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">8</button>
                </div>
                <div class="images-header-box">
                    <button type="button" class="btn btn-tpl-header">9</button>
                </div>
            </div>

            <!-- <div class="jumbotron">
                <button type="button" class="btn btn-tpl">0</button>
                <button type="button" class="btn btn-tpl">1</button>
                <button type="button" class="btn btn-tpl">2</button>
                <button type="button" class="btn btn-tpl">3</button>
                <button type="button" class="btn btn-tpl">4</button>
                <button type="button" class="btn btn-tpl">5</button>
                <button type="button" class="btn btn-tpl">6</button>
                <button type="button" class="btn btn-tpl">7</button>
                <button type="button" class="btn btn-tpl">8</button>
            </div> -->
        </div>
        <!--裁剪工具-->
        <div class="col-xs-12 hidden" id="imgSpace">
            <!--预览区域和换图-->
            <div class="row">
                <div class="col-xs-5">
                    <label class="btn btn-ruc80" for="inputImage" title="选择图片">
                        <input type="file" id="inputImage" class="hidden" />
                        <span>
                            选择图片
                        </span>
                    </label>

                    <button type="button" id="generateImage" class="btn btn-ruc80 disabled">生成头像</button>
                </div>
                <div class="col-xs-7">
                    <div class="imgPreview" style="width: 155px; height: 155px;">
                        <img src="" id="preview-img">
                    </div>
                    <img id="avatarPreview" src="" alt="请选择模板">
                </div>
            </div>
            <!-- 操作区域 -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel panel-ruc80" id="cropperSpace">
                        <div class="panel-heading">
                            <h3 class="panel-title">裁剪框</h3>
                            <h6>· 双指操作（或使用鼠标滚轮）以缩放图片<br>· 在裁剪区域外滑动以移动页面<br>· 某些型号手机可能出现图片翻转bug，建议先使用手机自带编辑器将其旋转到位再使用本制作器</h6>
                        </div>
                        <div class="panel-body" id="cropperCanvas">
                            <img id="image" src="">
                        </div>
                    </div>
                </div>
            </div>
            <!--生成图像-->
            <div class="row">
                <div class="col-xs-12" id="canvasSpace">
                    <canvas id="myCanvas" class="hidden"></canvas>
                </div>
                <div class="col-xs-12">
                    <div class="panel panel-ruc80 hidden" id="outputSpace">
                        <div class="panel-heading">
                            <h3 class="panel-title">顺德杏坛中学建校60周年纪念头像</h3>
                            <h6>· 请长按下图保存</h6>
                        </div>
                        <div class="panel-body">
                            <img src="" id="outputImage" class="img-responsive" alt="图片生成中，请稍等">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer-box">
  <img class="img" src="images/footer2.jpg"
</div>
<!-- <div class="footer-content">
  <p class="text-center">
      <small>
          Powered by <a href="javascript:void(0);">米格传播</a>
          <br>
          米格传播友情出品
      </small>
  </p>
</div> -->
<div>
  <a class="gif" href="http://fsmigo.com/"></a>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-1.12.4.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
/*!
 * Powered by uglifiyJS v2.6.1, Build by http://tool.uis.cc/jsmin/
 * build time: Sun Sep 17 2017 11:48:37 GMT+0300 (FLE 紊鋌ゆ��)
 */
$(document).ready(function() {
	function e(e) {
		var t = new Image;
		return t.crossOrigin = "*", t.src = e, t
	}
	var t, a = document.getElementById("image"),
		n = window.URL || window.webkitURL,
		i = (document.getElementById("actions"), {
			aspectRatio: 1,
			preview: ".imgPreview",
			rotatable: !1
		}),
		r = !1;
	const o = "images/header_img_", l = ".jpg";
	var c, d, s;
	$(".images-header-content .btn-tpl-header:not(.disabled)").each(function() {
		var e = $(this).html(),
			t = o + e + l;
		$(this).css("background-image", "url(" + t + ")")
	}),
  $(".images-header-content button:not(.disabled)").click(function() {
    $("#avatarPreview").attr("src", null), $("#avatarPreview").attr("alt", "模板载入中"), c = $(this).html(), d = 'http://linshengyin888.com/images/header_' + c + '.png', s = e(d), s.onload = function() {
      $("#avatarPreview").attr("src", s.src)
    }, $("#imgSpace").removeClass("hidden"), document.getElementById("imgSpace").scrollIntoView()
	}), n ? $("#inputImage").change(function() {
		var e, o = this.files;
		o && o.length && (e = o[0], /^image\/\w+/.test(e.type) ? (t && n.revokeObjectURL(t), a.src = t = n.createObjectURL(e), r && r.destroy(), r = new Cropper(a, i), $("#generateImage").removeClass("disabled")) : window.alert("请选择图片文件！"))
	}) : (inputImage.disabled = !0, inputImage.parentNode.className += " disabled"), $("#generateImage").click(function() {
		if (!$(this).hasClass("disabled")) {
			$("#outputImage").attr("src", null);
			const e = 640;
			var t = r.getData(),
				a = t.width,
				n = t.x,
				i = t.y,
				o = e / a,
				l = r.getImageData(),
				c = l.naturalHeight,
				d = l.naturalWidth,
				m = document.getElementById("myCanvas"),
        qr_code = document.getElementById("qr_code");
			m.width = m.height = e;
			var u = m.getContext("2d");
			u.fillStyle = "#fff", u.fillRect(0, 0, e, e);
			var g = document.getElementById("image");
			u.drawImage(g, -n * o, -i * o, d * o, c * o),u.drawImage(s, 0, 0, e, e),u.drawImage(qr_code, e-60, e-60, 60, 60);
			var v = document.getElementById("outputImage");
			v.src = m.toDataURL(""), $("#outputSpace").removeClass("hidden"), document.getElementById("outputSpace").scrollIntoView()
		}
	})
});
</script>
</body>
</html>
